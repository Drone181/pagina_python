<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... (previous head content remains the same) ... -->
</head>
<body>
    <!-- ... (previous body content remains the same) ... -->

    <script>
        let videoUrl = '';

        function isInstagramUrl(url) {
            // Regular expression to match Instagram URLs
            const instagramRegex = /^https?:\/\/(www\.)?instagram\.com\/(p|reel|tv)\/[\w-]+\/?/;
            return instagramRegex.test(url);
        }

        function getDownloadLink() {
            const instagramUrl = document.getElementById('instagram-url').value.trim();
            const message = document.getElementById('message');
            const thumbnail = document.getElementById('thumbnail');
            const downloadBtn = document.getElementById('download-btn');

            if (!isInstagramUrl(instagramUrl)) {
                message.textContent = 'Error: Please enter a valid Instagram video URL';
                thumbnail.style.display = 'none';
                downloadBtn.style.display = 'none';
                return;
            }

            message.textContent = 'Searching for video...';
            thumbnail.style.display = 'none';
            downloadBtn.style.display = 'none';

            fetch('/api/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ url: instagramUrl }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.video_url) {
                    videoUrl = data.video_url;
                    message.textContent = 'Video found! Click the download button to save it.';
                    downloadBtn.style.display = 'block';
                    
                    if (data.thumbnail_url) {
                        const proxyThumbnailUrl = `/api/thumbnail?url=${encodeURIComponent(data.thumbnail_url)}`;
                        thumbnail.src = proxyThumbnailUrl;
                        thumbnail.style.display = 'block';
                    }
                } else {
                    message.textContent = 'Error: ' + (data.error || 'Unable to find video');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                message.textContent = 'An error occurred while searching for the video.';
            });
        }

        function downloadVideo() {
            if (videoUrl) {
                window.location.href = `/api/download?url=${encodeURIComponent(videoUrl)}`;
            }
        }
    </script>
</body>
</html>